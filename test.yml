##Use existing Resource Group
data "azurerm_resource_group" "rg" {
    name    = "${var.resource_group_name}"
}

## Use existing Virtual Network
data "azurerm_virtual_network" "vnet" {
    name    =  "${var.virtual_network_name}"
    resource_group_name =  data.azurerm_resource_group.rg.name
}

##Use existing Subnet
data "azurerm_subnet" "subnet" {
    name    ="${var.subnet_name}"
    resource_group_name  = data.azurerm_resource_group.rg.name
    virtual_network_name = data.azurerm_virtual_network.vnet.name
}

##Use existing NSG
data "azurerm_network_security_group" "nsg" {
    name    ="${var.network_security_group_name}"
    resource_group_name  = data.azurerm_resource_group.rg.name
}

# create Network interface.
resource" azurerm_network_interface" "nic" {
    name = "${var.computer_name}-nic"
    location = "${var.resource_group_location}"
    resource_group_name = data.azurerm_resource_group.rg.name

    ip_configuration {
        name = "${var.computer_name}-nic-Config"
        subnet_id = data.azurerm_subnet.subnet.id
        private_ip_address_allocation = "dynamic"
    }
}

##Connect the Network Security Group to Network Ineterface
resource "azurerm_network_interface_security_group_association" "nisg"{
    network_interface_id        = azurerm_network_interface.nic.id
    network_security_group_id   = data.azurerm_network_security_group.nsg.id
}

#use existing storage account
data "azurerm_storage_account" "storageaccount"{
    name                        = "${var.storage_account_name}"
    resource_group_name        = data.azurerm_resource_group.rg.name  
}


# Create virtual machine
resource "azurerm_windows_virtual_machine" "vm" {
    name                  = "${var.vm_computer_name}"
    location              = "${var.resource_group_location}"
    resource_group_name   = data.azurerm_resource_group.rg.name
    network_interface_ids = [azurerm_network_interface.nic.id]
    encryption_at_host_enabled = true
    size                  = "${var.size}"
	computer_name  = "${var.computer_name}"
    admin_username = "${var.admin_username}"
    admin_password = "${var.admin_password}"
   
	os_disk {
        name                 = "${var.computer_name}_OsDisk"
        caching              = "ReadWrite"
        storage_account_type = "Standard_LRS"
        disk_size_gb         = "${var.disk_size_gb}"
    }

 
    source_image_reference {
        publisher = "${var.publisher}" 
        offer     = "${var.offer}" 
        sku       = "${var.sku}"
        version   = "latest"
    }
}

============================main.tf===========================================================
variable "subscription_id" {
    description = "Enter Subscription id"
}

variable "tenant_id" {
description = "Enter tenant id"
}

variable "client_id" {
  description = "Enter certificate id for Application created in Azure."
}

variable "client_certificate_path" {
  description = "Enter client secret for Application created in Azure."
  type        = string
  sensitive   = true
}

variable "resource_group_name" {
    type = string
  }

variable "resource_group_location" {
  description = "(Optional) The location in which the resources will be created."
  type        = string
  default     = "west europe"
}

variable "subnet_name" {
  type        = string
}

variable "virtual_network_name" {
  type        = string
}

variable "network_security_group_name" {
  type        = string
}

variable "nsg_name" {
  type        = string
}

variable "sku" {
  type        = string
}

variable "disk_size_gb" {
  type        = string
}

variable "size" {
  type        = string
}

variable "computer_name" {
  type        = string
}

variable "vm_computer_name" {
  type        = string
}

variable "admin_username" {
  type        = string
}
	
variable "admin_password" {
  type        = string
  sensitive   = true
}

  variable "publisher" {
  type        = string
}

variable "offer" {
  type        = string
}

variable "storage_account_name" {
  type        = string
}
##################################################varible####################################
subscription_id                   = 
tenant_id                         = 
client_id                         = 
client_certificate_path           = 
resource_group_name               = "AZP-104-RG"
virtual_network_name              = "AZP-104-VNET"
nsg_name                          = "AZP-104-NSG"
network_security_group_name       = "AZP-104-NSG"
subnet_name                       = "subnet-westeurope"
disk_size_gb                      = "127"
size                              = "Standard_B1s"
computer_name                     = "TerraformWin1"
vm_computer_name                  = "TerraformWin1"
admin_username                    = "Adminaccount"
admin_password                    = 
storage_account_name              = "terraformstor"
publisher                         = "MicrosoftWindowsServer"
offer                             = "WindowsServer"
sku                               = "2016-Datacenter"
################################################################tfvars############################


